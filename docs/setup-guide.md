# AI Concierge セットアップガイド

このガイドでは、Difyを活用したAIチャットボットサービス「AI Concierge」のセットアップ方法を説明します。

## 前提条件

以下のソフトウェアがインストールされていることを確認してください：

- Node.js (v14以上)
- npm または yarn
- Docker と Docker Compose (オプション、コンテナ化して実行する場合)
- PostgreSQL (ローカルにインストールする場合)

## Difyアカウントの設定

1. [Dify公式サイト](https://dify.ai)にアクセスし、アカウントを作成します。
2. ログイン後、新しいアプリケーションを作成します。
   - アプリケーションタイプとして「Chatbot」を選択します。
   - 必要に応じて設定をカスタマイズします。
3. アプリケーションが作成されたら、APIキーとアプリケーションIDを取得します。
   - 「API Reference」セクションでAPIキーを確認できます。
   - これらの情報は後ほど環境変数として設定します。

## プロジェクトのセットアップ

### 環境変数の設定

1. バックエンドディレクトリに移動し、`.env.example`ファイルを`.env`にコピーします：

```bash
cd backend
cp .env.example .env
```

2. `.env`ファイルを編集し、Dify APIキーとアプリケーションIDを設定します：

```
DIFY_API_KEY=your_dify_api_key_here
DIFY_APP_ID=your_dify_app_id_here
```

### フロントエンドのセットアップ

1. フロントエンドディレクトリに移動し、依存関係をインストールします：

```bash
cd ../frontend
npm install
```

2. 開発サーバーを起動します：

```bash
npm start
```

フロントエンドは`http://localhost:3000`でアクセスできます。

### バックエンドのセットアップ

1. バックエンドディレクトリに移動し、依存関係をインストールします：

```bash
cd ../backend
npm install
```

2. 開発サーバーを起動します：

```bash
npm run dev
```

バックエンドは`http://localhost:8000`でアクセスできます。

## Dockerを使用したセットアップ（オプション）

プロジェクトルートディレクトリで以下のコマンドを実行します：

```bash
docker-compose up
```

これにより、フロントエンド、バックエンド、PostgreSQLデータベースが起動します。

- フロントエンド: `http://localhost:3000`
- バックエンド: `http://localhost:8000`
- PostgreSQL: `localhost:5432`

## 知識ベースの設定

1. Difyダッシュボードにログインします。
2. 作成したアプリケーションの「Knowledge Base」セクションに移動します。
3. 「Create Knowledge Base」をクリックして新しい知識ベースを作成します。
4. 知識ベースに名前と説明を付けます。
5. 「Upload Documents」をクリックしてドキュメントをアップロードします。
   - サポートされているファイル形式：PDF、DOCX、TXT、Markdownなど
6. ドキュメントのインデックス作成が完了するまで待ちます。
7. 知識ベースをアプリケーションに接続します。

## カスタマイズ

### プロンプトのカスタマイズ

Difyダッシュボードの「Prompt Engineering」セクションで、チャットボットの応答を調整できます。

### ワークフローの設定

複雑なタスクを自動化するために、Difyの「Workflow」機能を使用できます。

### UIのカスタマイズ

フロントエンドのコードを編集して、UIをカスタマイズできます。主要なコンポーネントは以下の場所にあります：

- `frontend/src/components` - 再利用可能なUIコンポーネント
- `frontend/src/pages` - アプリケーションの主要ページ
- `frontend/src/theme` - UIテーマとスタイル設定

## トラブルシューティング

### APIキーの問題

- Dify APIキーが正しく設定されていることを確認してください。
- APIキーに適切な権限が付与されていることを確認してください。

### CORS エラー

- バックエンドの`FRONTEND_URL`環境変数が正しく設定されていることを確認してください。
- ブラウザの開発者ツールでネットワークリクエストを確認してください。

### データベース接続エラー

- PostgreSQLが実行されていることを確認してください。
- データベース接続情報（ホスト、ポート、ユーザー名、パスワード）が正しいことを確認してください。

## デプロイ

### フロントエンドのデプロイ

フロントエンドは、Vercel、Netlify、AWS Amplifyなどのサービスにデプロイできます。

```bash
cd frontend
npm run build
```

生成された`build`ディレクトリをデプロイします。

### バックエンドのデプロイ

バックエンドは、AWS EC2、Heroku、Google Cloud Runなどのサービスにデプロイできます。

```bash
cd backend
npm run build
```

本番環境では、`npm start`コマンドを使用してサーバーを起動します。

## セキュリティに関する注意事項

- 本番環境では、適切なセキュリティ対策を講じてください。
- APIキーやデータベース認証情報などの機密情報は、環境変数として安全に管理してください。
- HTTPS接続を使用してください。
- 適切なアクセス制御とユーザー認証を実装してください。
